<h1><center> Multi Thread </center></h1>

###### tags: `💻 TIL`, `Computer Science`, `Multi Thread`, `Operation System`
###### date: `2024-02-02T15:12:33.284Z`

> [color=#724cd1][name=데릭]
> [Nossi.DEV](https://www.nossi.dev/39dd8c30-a349-4d0c-961a-e219db7c91f7)
> [Multi Thread - 위키백과](https://ko.wikipedia.org/wiki/%EB%A9%80%ED%8B%B0%EC%8A%A4%EB%A0%88%EB%94%A9)

## Multi Thread

> 스레드는 한 프로세스 내에서 실행되는 동작(기능 Function)의 단위이다. 각 스레드는 속해있는 프로세스의 스택 메모리를 제외한 나머지 메모리 영역을 공유할 수 있다. <br>
> 멀티 스레드란 하나의 프로세스가 동시에 여러 개의 일을 수행할 수 있도록 해주는 것이다. 즉, 하나의 프로세스에서(실행된 하나의 프로그램에서) 여러 작업을 병렬로 처리하기 위해 멀티 스레드를 사용한다. 멀티 스레드에서는 한 프로세스 내에 여러 개의 스레드가 있고, 각 스레드들은 스택 메모리를 제외한 나머지 영역(Code, Data, Heap)영역을 공유하게 된다. 

멀티스레딩 컴퓨터는 여러 개의 스레드를 효과적으로 실행할 수 있는 하드웨어 지원을 갖추고 있는 것이다. 이는 스레드가 모두 같은 주소 공간에서 동작하여 하나의 CPU 캐시 공유 집합과 하나의 변환 색인 버퍼(TLB)만 있는 멀티프로세서 시스템(멀티 코어 시스템)과는 구별된다. 

그러므로 멀티스레딩은 프로그램 안에서 병렬 처리의 이점을 맛볼 수 있지만, 멀티 프로세싱 시스템은 여러 프로그램들을 병렬로 처리할 수 있다.

멀티프로세싱 시스템이 여러 개의 완전한 처리 장치들을 포함하는 반면, 멀티스레딩은 스레드 수준뿐 아니라 명령어 수준의 병렬 처리에까지 신경을 쓰면서 하나의 코어에 대한 이용성을 증가하는 것에 초점을 둔다.

**NOTE**
> Thread는 프로세스 내에서 독립적인 기능을 수행한다. 즉, 독립적으로 함수를 호출함을 의미하고 이를 위해 스택 메모리가 각자 필요한 거다. 

> 독립적인 스택 메모리와 PC Register가 필요하다.

## 장단점

**장점**

1. 응답성: 대화형 프로그램을 멀티스레드화하면, 프로그램의 일부분(스레드)이 중단되거나 긴 작업을 수행하더라도 프로그램의 수행이 계속되어, 사용자에 대한 응답성이 증가된다. 예를 들어, 멀티스레드가 적용된 웹 브라우저 프로그램에서 하나의 스레드가 이미지 파일을 로드하고 있는 동안, 다른 스레드에 사용자와의 상호 작용이 가능하다.

2. 자원 공유: 스레드는 자동적으로 그들이 속한 프로세스의 자원들과 메모리를 공유한다. 코드 공유의 이점은, 한 응용 프로그램이 같은 주소 공간 내에 여러 개의 다른 활동성 스레드를 가질 수 있다는 점이다. 

3. 경제성: 프로세스 생성에 메모리와 자원을 할당하는 것은 비용이 많이 든다. 스레드는 자신이 속한 프로세스의 자원들을 공유하기 때문에, 스레드를 생성하고 문맥교환을 하는 편이 보다 경제적이다. 

4. 멀티프로세서 활용: 멀티프로세서 구조에서는 각가의 스레드가 다른 프로세서에서 병렬로 수행될 수 있다. 단일 스레드 프로세스는 CPU가 많아도 CPU 한개에서만 실행된다. 즉, 다중 스레드화를 하면 다중 CPU에서 병렬성이 증가된다. 

**단점**

- 다중 스레드는 캐시나 변환 색인 버퍼(TLB)와 같은 하드웨어 리소스를 공유할 때 서로를 간섭할 수 있다. 
- 하나의 스레드만 실행 중인 경우 싱글 스레드의 실행 시간이 개선되지 않고 오히려 지연될 수 있다. 
- 멀티스레딩의 하드웨어 지원을 위해 응용 프로그램과 운영 체제 둘 다 충분한 변화가 필요하다.
- 스레드 스케줄링은 멀티스레딩의 주요 문제이기도 하다.

## 스택 메모리 & PC Register 

Thread가 함수를 호출하기 위해서는 인자 전달, Return Address 저장, 함수 내 지역변수 저장 등을 위한 독립적인 스택 메모리 공간을 필요로 한다. 결과적으로 스레드는 프로세스로부터 스택 메모리 영역은 독립적으로 할당받고, Code, Data, Heap 영역은 공유하는 형태를 갖게 된다고 한다. 

또한, 멀티 스레드에서는 각각의 스레드마다 PC Register를 가지고 있어야 한다. 그 이유는 한 프로세스 내에서도 스레드끼리 Context Switch가 일어나게 되는데, PC Register에 code address가 저장되어 있어야 이어서 실행할 수 있기 때문이다. 

![image](https://hackmd.io/_uploads/BkoRaU9qp.png)
